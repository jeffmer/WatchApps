wOS.setUI||eval(STOR.read("setui.js"));
E.showMenu=function(p){g.clear(1);wOS.setLCDPower(1);if(p){var r=g.getWidth()-9;g.getHeight();var f=Object.keys(p),a=p[""];a&&f.splice(f.indexOf(""),1);a instanceof Object||(a={});a.fontHeight=16;a.x=2;a.x2=r-4;a.y=24;a.y2=220;void 0===a.selected&&(a.selected=0);a.fontHeight||(a.fontHeight=6);var t=0|a.x,q=a.x2||g.getWidth()-1,n=0|a.y,v=a.y2||g.getHeight()-1;a.title&&(n+=a.fontHeight+2);var d={lastIdx:0,draw:function(b,c){var k=0|Math.min((v-n)/a.fontHeight,f.length),e=E.clip(a.selected-(k>>1),0,
f.length-k);e!=d.lastIdx&&(b=void 0);d.lastIdx=e;var h=n;g.reset().setFont("6x8",2).setFontAlign(0,-1,0);void 0===b&&a.title&&(g.drawString(a.title,(t+q)/2,n-a.fontHeight-2),g.drawLine(t,n-2,q,n-2));void 0!==b&&(e<b&&(h+=a.fontHeight*(b-e),e=b),e+k>c&&(k=1+c-b));for(;k--;){var l=f[e],u=p[l],m=e==a.selected&&!d.selectEdit;g.setColor(m?g.theme.bgH:g.theme.bg);g.fillRect(t,h,q,h+a.fontHeight-1);g.setColor(m?g.theme.fgH:g.theme.fg);g.setFontAlign(-1,-1);g.drawString(l,t,h);"object"==typeof u&&(l=q,m=
u.value,u.format&&(m=u.format(m)),d.selectEdit&&e==a.selected&&(l-=25,g.setColor(g.theme.bgH).fillRect(l-(g.stringWidth(m)+4),h,q,h+a.fontHeight-1),g.setColor(g.theme.fgH).drawImage("\f\u0005\u0081\x00 \u0007\x00\u00f9\u00f0\u000e\x00@",l,h+(a.fontHeight-10)/2,{scale:2})),g.setFontAlign(1,-1),g.drawString(m,l-2,h));g.setColor(g.theme.fg);h+=a.fontHeight;e++}g.setFontAlign(-1,-1);k=e<f.length;g.drawImage("\b\b\u0001\u00108|\u00fe\u0010\u0010\u0010\u0010",r,40);g.drawImage("\b\b\u0001\u0010\u0010\u0010\u0010\u00fe|8\u0010",
r,194);g.drawImage("\b\b\u0001\x00\b\f\u000e\u00ff\u000e\f\b",r,116);g.setColor(k?g.theme.fg:g.theme.bg).fillPoly([104,220,136,220,120,228]);g.flip()},select:function(b){b=p[f[a.selected]];if("function"==typeof b)b(d);else if("object"==typeof b){if("number"==typeof b.value)d.selectEdit=d.selectEdit?void 0:b;else if("boolean"==typeof b.value&&(b.value=!b.value),b.onchange)b.onchange(b.value);d.draw()}},move:function(b){if(d.selectEdit){var c=d.selectEdit;c.value-=(b||1)*(c.step||1);void 0!==c.min&&
c.value<c.min&&(c.value=c.min);void 0!==c.max&&c.value>c.max&&(c.value=c.max);if(c.onchange)c.onchange(c.value);d.draw(a.selected,a.selected)}else c=a.selected,a.selected=(b+a.selected)%f.length,0>a.selected&&(a.selected+=f.length),d.draw(Math.min(c,a.selected),Math.max(c,a.selected))}};d.draw();wOS.setUI("updown",function(b){b?d.move(b):d.select()});return d}wOS.setUI()};